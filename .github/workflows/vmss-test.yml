name: VMSS Runner Debug

on:
  workflow_dispatch:  # Allows manual trigger

jobs:
  debug:
    name: VMSS Diagnostics
    runs-on: [self-hosted, vmss, linux]

    steps:
      - name: Print Host Info
        run: |
          echo "üè∑Ô∏è Hostname: $(hostname)"
          echo "üë§ Whoami: $(whoami)"
          echo "üïí Date: $(date)"
          echo "üìÇ Current Dir: $(pwd)"
          uname -a

      - name: Print Environment Variables
        run: |
          echo "üåê Environment:"
          env | sort

      - name: Show Network Info
        run: |
          echo "üîó Network interfaces:"
          ip a
          echo "üß≠ DNS resolution:"
          nslookup github.com || true

      - name: Disk & Memory
        run: |
          echo "üíæ Disk:"
          df -h
          echo "üß† Memory:"
          free -h

      - name: List Running Processes (Top 20)
        run: |
          echo "üîç Top 20 Processes:"
          ps -eo pid,ppid,user,cmd,%mem,%cpu --sort=-%cpu | head -n 20

      - name: Check for Azure CLI
        run: |
          echo "üîß Checking az CLI"
          if command -v az &> /dev/null; then
            echo "‚úÖ az CLI is installed"
            az version
          else
            echo "‚ùå az CLI not found"
          fi

      - name: Final Log
        run: echo "‚úÖ Runner seems to be functional. Review logs above."

